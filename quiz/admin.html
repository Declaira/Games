<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Admin - Contrôle du Quiz</title>
    <style>
        body { font-family: sans-serif; background: #f4f7f6; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .btn { padding: 10px 20px; cursor: pointer; border: none; border-radius: 5px; color: white; margin-right: 10px; }
        .btn-next { background: #3498db; }
        .btn-reset { background: #e74c3c; }
        .btn-reveal { background: #f39c12; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Panneau Admin</h1>
        <div id="status">Question actuelle : <strong id="q-num">0</strong></div>
        <hr>
        <button id="nextBtn" class="btn btn-next">Question Suivante</button>
        <button id="revealBtn" class="btn btn-reveal">Révéler la Réponse</button>
        <button id="resetBtn" class="btn btn-reset">Réinitialiser (Reset IDs)</button>

        <h3>Réponses reçues :</h3>
        <div id="responsesList"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getDatabase, ref, onValue, set, update, remove } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB29fMpTwBgsqkjijkNoQJ2kGChSeQDX_w",
            authDomain: "quiz-ea203.firebaseapp.com",
            databaseURL: "https://quiz-ea203-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "quiz-ea203",
            storageBucket: "quiz-ea203.firebasestorage.app",
            messagingSenderId: "605137421110",
            appId: "1:605137421110:web:289e0876fe06108deaa997"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        let questions = {};
        let currentState = { currentQ: 0 };

        onValue(ref(database, 'questions'), (s) => questions = s.val() || {});
        onValue(ref(database, 'control'), (s) => {
            currentState = s.val() || { currentQ: 0 };
            document.getElementById('q-num').textContent = currentState.currentQ;
        });

        document.getElementById('nextBtn').onclick = () => {
            update(ref(database, 'control'), { currentQ: currentState.currentQ + 1, showAnswers: false });
        };

        document.getElementById('revealBtn').onclick = () => {
            update(ref(database, 'control'), { showAnswers: true });
        };

        document.getElementById('resetBtn').onclick = () => {
            if(confirm("Tout effacer ?")) {
                remove(ref(database, 'responses'));
                remove(ref(database, 'scores'));
                set(ref(database, 'control'), { currentQ: 0, resetSignal: Date.now() });
            }
        };

        // Affichage des réponses
        onValue(ref(database, 'responses'), (snap) => {
            const list = document.getElementById('responsesList');
            list.innerHTML = '';
            const data = snap.val() || {};
            const qKeys = Object.keys(questions);
            const currentKey = qKeys[currentState.currentQ - 1];

            for(let id in data) {
                if(data[id][currentKey]) {
                    const p = document.createElement('p');
                    p.innerHTML = `<strong>${data[id].name || "Anonyme"}</strong> : ${data[id][currentKey].answer}`;
                    list.appendChild(p);
                }
            }
        });
    </script>
</body>
</html>