
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>üß† Quiz √âcrit</title>
  <link rel="icon" href="../logo/logo.png" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Quicksand', sans-serif; margin: 0; padding: 0; background: linear-gradient(to bottom right, #fff3cd, #ffe5b4, #ffd1d1); color: #2c3e50; }
    header { background: linear-gradient(to right, #ff9a00, #ff4e00); padding: 20px; text-align: center; color: white; font-size: 2em; }
    .container { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; padding: 30px; }
    .card { background: #ffd1d1; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); padding: 20px; min-width: 200px; text-align: center; position: relative; }
    .btn { margin-top: 10px; padding: 10px 20px; border: none; background: #ff6f00; color: white; font-weight: bold; border-radius: 8px; cursor: pointer; }
    .btn:hover { background: #e65c00; }
    .actions { position: absolute; top: 10px; right: 10px; }
    .actions span { margin-left: 10px; cursor: pointer; font-size: 1.2em; }
    .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
    .modal-content { background: linear-gradient(to bottom right, #fff3cd, #ffe5b4, #ffd1d1); padding: 20px; border-radius: 10px; width: 50vw; max-width: 500px; }
    textarea, input[type="text"] { width: 31vw; margin: 10px 0; padding: 10px; border-radius: 6px; border: 1px solid #ccc; }
    .hidden { display: none; }
    #quiz-container, #feedback, #result { text-align: center; padding: 20px; }
    #play-btn {background: linear-gradient(to right, #ff9a00, #ff4e00); color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 1.2em;margin-top: 10px;}
    #play-btn:hover {background-color: #e65c00;}
  </style>
</head>
<body>
  
  <script src="../header.js"></script>
<script>
  injectHeader({
    title: "Mes Quiz",
    homeLink: "../accueil.html",
    showHome: true
  });
</script>
  </script>


  <div style="text-align:center; padding: 20px;">
    <button class="btn" onclick="openModal()">‚ûï Ajouter un th√®me</button>
    <button class="btn" onclick="exportThemes()">üì§ Exporter</button>
    <input type="file" id="importFile" accept=".json" onchange="importThemes()" class="btn" style="background:#aaa;">
  </div>

  <div id="start-screen" class="container"></div>

  <div id="quiz-container" class="hidden">
    <div id="son"></div>
    <div id="quiz"></div>
    <input type="text" id="answer-input" placeholder="Tape ta r√©ponse ici..." />
    <div id="feedback"></div>
    <button id="submit-btn" class="btn">Valider</button>
    <div id="result"></div>
    <button id="restart-btn" class="btn hidden">üîÅ Retour</button>
  </div>

  <div id="theme-modal" class="modal">
    <div class="modal-content">
      <h3 id="modal-title">Ajouter un th√®me</h3>
      <input type="text" id="theme-name" placeholder="Nom du th√®me">
      <textarea id="theme-questions" placeholder="Une question ?=R√©ponse" rows="6"></textarea>
      <button onclick="saveTheme()" class="btn">üíæ Enregistrer</button>
      <button onclick="closeModal()" class="btn" style="background:#aaa;">Annuler</button>
    </div>
  </div>

<script>
let defaultThemes = {
  "Science": [
    { question: "Quel est le symbole chimique de l'eau ?", answer: "H2O" },
    { question: "Quelle est cette plan√®te.png", answer: "Mars" }
    
  ]
};

let customThemes = JSON.parse(localStorage.getItem("customThemes")) || {};
let editingTheme = null;

function saveThemesToStorage() {
  localStorage.setItem("customThemes", JSON.stringify(customThemes));
}

function renderThemes() {
  const container = document.getElementById("start-screen");
  container.innerHTML = "";

  const allThemes = { ...defaultThemes, ...customThemes };

  for (const name in allThemes) {
    const card = document.createElement("div");
    card.className = "card";

    const title = document.createElement("h2");
    title.textContent = name;

    const button = document.createElement("button");
    button.className = "btn";
    button.textContent = "Commencer";
    button.onclick = () => startQuiz(name);

    card.appendChild(title);
    card.appendChild(button);

    // Si c'est un th√®me personnalis√©, on ajoute les actions ‚úèÔ∏è üóëÔ∏è
    if (customThemes[name]) {
      const actions = document.createElement("div");
      actions.className = "actions";

      const editBtn = document.createElement("span");
      editBtn.textContent = "‚úèÔ∏è";
      editBtn.onclick = () => editTheme(name);

      const deleteBtn = document.createElement("span");
      deleteBtn.textContent = "üóëÔ∏è";
      deleteBtn.onclick = () => deleteTheme(name);

      actions.appendChild(editBtn);
      actions.appendChild(deleteBtn);
      card.appendChild(actions);
    }

    container.appendChild(card);
  }
}

function openModal() {
  editingTheme = null;
  document.getElementById("theme-name").value = "";
  document.getElementById("theme-questions").value = "";
  document.getElementById("modal-title").textContent = "Ajouter un th√®me";
  document.getElementById("theme-modal").style.display = "flex";
}

function closeModal() {
  document.getElementById("theme-modal").style.display = "none";
}

function saveTheme() {
  const name = document.getElementById("theme-name").value.trim();
  const lines = document.getElementById("theme-questions").value.trim().split("\n");
  if (!name || lines.length === 0) return alert("Remplir nom et questions");

  const questions = lines.map(l => {
    const [q, a] = l.split("=");
    return { question: q.trim(), answer: a.trim() };
  });

  if (editingTheme && customThemes[editingTheme]) delete customThemes[editingTheme];
  customThemes[name] = questions;
  saveThemesToStorage();
  closeModal();
  renderThemes();
}

function editTheme(name) {
  editingTheme = name;
  document.getElementById("theme-name").value = name;
  document.getElementById("theme-questions").value = customThemes[name].map(q => q.question + " = " + q.answer).join("\n");
  document.getElementById("modal-title").textContent = "Modifier le th√®me";
  document.getElementById("theme-modal").style.display = "flex";
}

function deleteTheme(name) {
  if (confirm("Supprimer le th√®me ?")) {
    delete customThemes[name];
    saveThemesToStorage();
    renderThemes();
  }
}

function exportThemes() {
  const blob = new Blob([JSON.stringify(customThemes, null, 2)], { type: "application/json" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "mes_themes_quiz.json";
  link.click();
}

function importThemes() {
  const file = document.getElementById("importFile").files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    try {
      customThemes = JSON.parse(e.target.result);
      saveThemesToStorage();
      renderThemes();
    } catch {
      alert("Fichier invalide");
    }
  };
  reader.readAsText(file);
}

// Quiz logique
let currentQuestion = 0, score = 0, userAnswers = [], questions = [];

function startQuiz(theme) {
  // R√©initialiser les variables et vider le contenu du r√©capitulatif
  questions = customThemes[theme] || defaultThemes[theme];
  currentQuestion = 0; 
  score = 0; 
  userAnswers = [];
  
  // Vider le contenu du r√©capitulatif (section #result)
  document.getElementById("result").innerHTML = "";

  // Cacher l'√©cran de d√©marrage et afficher le quiz
  document.getElementById("start-screen").classList.add("hidden");
  document.getElementById("quiz-container").classList.remove("hidden");
  document.getElementById("restart-btn").classList.add("hidden");
  document.getElementById("answer-input").style.display = 'inline-block';
  document.getElementById("submit-btn").style.display = 'inline-block';
  
  // Afficher la premi√®re question
  showQuestion();
}


function normalize(s) {
  return s.normalize("NFD").replace(/[ÃÄ-ÕØ]/g, "").toLowerCase().trim();
}
function levenshtein(a, b) {
  const m = Array.from({ length: a.length + 1 }, () => []);
  for (let i = 0; i <= a.length; i++) m[i][0] = i;
  for (let j = 0; j <= b.length; j++) m[0][j] = j;
  for (let i = 1; i <= a.length; i++) {
    for (let j = 1; j <= b.length; j++) {
      const c = a[i - 1] === b[j - 1] ? 0 : 1;
      m[i][j] = Math.min(m[i - 1][j] + 1, m[i][j - 1] + 1, m[i - 1][j - 1] + c);
    }
  }
  return m[a.length][b.length];
}
function isAnswerClose(a, b) {
  const d = levenshtein(normalize(a), normalize(b));
  return d <= Math.floor(b.length * 0.3);
}



// Logique pour afficher la question
function showQuestion() {
  const q = questions[currentQuestion];

  
  if (q.question.endsWith('.mp3')) {
    
    document.getElementById("quiz").innerHTML += `
    <audio id="audio-player" style="display:none;">
      <source src="${q.question}" type="audio/mp3">
      Votre navigateur ne prend pas en charge l'√©l√©ment audio.
    </audio>
    <button id="play-btn" onclick="toggleAudio()" class="btn">üéµ Lire</button>
  `;
  q.question = q.question.replace('.mp3', ' ?');
  document.getElementById("son").innerHTML = "<h3>" + q.question + "</h3>";

  }
  // V√©rifier si la question est une image
  else{
    if (q.question.endsWith('.png')) {
    // Afficher l'image si c'est une image PNG
    
    document.getElementById("quiz").innerHTML = `<img src="${q.question}" alt="Question Image" style="max-width: 100%; height: auto;" />`;
    document.getElementById("son").innerHTML = "";
    }
    else {
    // Sinon afficher la question sous forme de texte
    document.getElementById("quiz").innerHTML = "<h3>" + q.question + "</h3>";
    document.getElementById("son").innerHTML = "";
    }
  } 
  
  

  // R√©initialiser le champ de saisie de la r√©ponse et le feedback
  document.getElementById("answer-input").value = "";
  document.getElementById("feedback").textContent = "";
  document.getElementById("answer-input").disabled = false;
}

// Logique de r√©initialisation lors du red√©marrage du quiz
document.getElementById("restart-btn").onclick = () => {
  // Rediriger vers la page quiz.html
  window.location.href = 'quiz.html';
};


// Fonction pour valider la r√©ponse et afficher le feedback
function validateAnswer() {
  const userAnswer = document.getElementById("answer-input").value;
  const correctAnswer = questions[currentQuestion].answer;
  const isCorrect = isAnswerClose(userAnswer, correctAnswer);

  // Afficher le feedback apr√®s soumission
  document.getElementById("feedback").textContent = isCorrect ? "‚úÖ Bonne r√©ponse" : "‚ùå R√©ponse attendue : " + correctAnswer;
  document.getElementById("feedback").style.color = isCorrect ? "green" : "red";

  // Mettre √† jour le score
  score += isCorrect ? 1 : 0;

  // Ajouter la r√©ponse √† userAnswers avant de passer √† la question suivante
  userAnswers.push({
    question: questions[currentQuestion].question,
    userAnswer: userAnswer,
    correctAnswer: correctAnswer,
    isCorrect: isCorrect
  });

  // Passer √† la question suivante ou afficher le r√©sultat si c'est la derni√®re question
  currentQuestion++;
  setTimeout(() => {
    if (currentQuestion < questions.length) {
      showQuestion();  // Afficher la question suivante
    } else {
      showResult();  // Afficher le score
    }
  }, 1000);
}

document.getElementById("submit-btn").onclick = validateAnswer;
document.getElementById("answer-input").addEventListener("keydown", e => {
  if (e.key === "Enter") { 
    e.preventDefault(); 
    validateAnswer(); 
  }
});
document.addEventListener('keydown', function(event) {
  // V√©rifie si la touche press√©e est "Entr√©e" et si le bouton "Rejouer" est visible
  if (event.key === "Enter" && !document.getElementById("restart-btn").classList.contains("hidden")) {
    // Si c'est le cas, clique sur le bouton "Rejouer"
    document.getElementById("restart-btn").click();
  }
});
function toggleAudio() {
  const audioPlayer = document.getElementById('audio-player');
  const playButton = document.getElementById('play-btn');

  if (audioPlayer.paused) {
    audioPlayer.play();
    playButton.textContent = "‚è∏Ô∏è Pause";
  } else {
    audioPlayer.pause();
    playButton.textContent = "üéµ Lire";
  }
}
// Affichage du r√©sultat final
function showResult() {
  document.getElementById("quiz").innerHTML = "";
  document.getElementById("answer-input").style.display = "none";
  document.getElementById("submit-btn").style.display = "none";
  document.getElementById("feedback").style.display = "none";

  const result = document.getElementById("result");
  result.innerHTML = `<h2>Score : ${score} / ${questions.length}</h2><hr>`;

  userAnswers.forEach((entry, index) => {
    // V√©rifier si la question est une image et remplacer l'extension .png par "?"
    let questionText = entry.question;
    if (questionText.endsWith('.png')) {
      // Remplacer l'extension .png par un "?"
      questionText = questionText.replace('.png', ' ?');
    }
    if (questionText.endsWith('.mp3')) {
      // Remplacer l'extension .mp3 par un "?"
      questionText = questionText.replace('.mp3', ' ?');
    }

    result.innerHTML += `
      <div style="margin-bottom: 10px;">
        <strong>Q${index + 1} : ${questionText}</strong><br>
        Votre r√©ponse : <span style="color: ${entry.isCorrect ? 'green' : 'red'}">${entry.userAnswer}</span><br>
        Bonne r√©ponse : <strong>${entry.correctAnswer}</strong>
      </div><hr>
    `;
  });

  document.getElementById("restart-btn").classList.remove("hidden");
}



renderThemes();
</script>
</body>
</html>
